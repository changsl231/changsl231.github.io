<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>留白</title>
  
  <subtitle>留白的博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://changsl231.xyz/"/>
  <updated>2020-06-11T09:04:45.206Z</updated>
  <id>http://changsl231.xyz/</id>
  
  <author>
    <name>changsl231</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mmdetection训练笔记</title>
    <link href="http://changsl231.xyz/2020/06/10/mmdetection%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>http://changsl231.xyz/2020/06/10/mmdetection%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/</id>
    <published>2020-06-10T02:09:36.000Z</published>
    <updated>2020-06-11T09:04:45.206Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mmdetection"><a href="#mmdetection" class="headerlink" title="mmdetection"></a>mmdetection</h1><h2 id="1-mmdetection简介"><a href="#1-mmdetection简介" class="headerlink" title="1. mmdetection简介"></a>1. mmdetection简介</h2><p>mmdetection是基于pytorch的开源对象检测工具箱，由商汤科技和香港中文大学<a href="http://mmlab.ie.cuhk.edu.hk/" target="_blank" rel="noopener">Multimedia Laboratory, CUHK</a>联合开发。</p><p>主要特性：</p><a id="more"></a><ul><li><p>模块化设计</p><p>将检测框架分解为不同的组件，并且可以通过组合不同的模块轻松构建定制的对象检测框架 。 </p></li><li><p>支持多种框架</p><p>该工具箱直接支持流行和现代的检测框架，<em>例如</em> Faster RCNN，Mask RCNN，RetinaNet等。</p></li><li><p>高效率</p><p>所有基本的bbox和mask操作都在GPU上运行。训练速度比其他代码库（包括<a href="https://github.com/facebookresearch/detectron2" target="_blank" rel="noopener">Detectron2</a>，<a href="https://github.com/facebookresearch/maskrcnn-benchmark" target="_blank" rel="noopener">maskrcnn-benchmark</a>和<a href="https://github.com/TuSimple/simpledet" target="_blank" rel="noopener">SimpleDet</a>）快或可比。</p></li><li><p>最先进</p><p>该工具箱源自<em>MMDet</em>团队开发的代码库，该团队在2018年赢得了<a href="http://cocodataset.org/#detection-leaderboard" target="_blank" rel="noopener">COCO检测挑战赛的冠军</a>，并且一直在推动它向前发展。</p><p>除了MMDetection之外，<em>MMDet</em>还发布了<a href="https://github.com/open-mmlab/mmcv" target="_blank" rel="noopener">mmcv</a>库用于计算机视觉研究，该库在很大程度上依赖于此工具箱。</p></li></ul><h2 id="2-训练Mask-RCNN过程"><a href="#2-训练Mask-RCNN过程" class="headerlink" title="2. 训练Mask-RCNN过程"></a>2. 训练Mask-RCNN过程</h2><h3 id="2-1-数据集"><a href="#2-1-数据集" class="headerlink" title="2.1 数据集"></a>2.1 数据集</h3><p>准备coco数据集，运行labelme2coco.py  </p><h3 id="2-2-修改预训练模型"><a href="#2-2-修改预训练模型" class="headerlink" title="2.2 修改预训练模型"></a>2.2 修改预训练模型</h3><p>打开changmaskrcnn.py文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">pretrained_weights  = torch.load(<span class="string">'checkpoints/mask_rcnn_r50_fpn_1x_coco_20200205-d4b0c5d6.pth'</span>)</span><br><span class="line"></span><br><span class="line">num_class = <span class="number">1</span> <span class="comment"># 填写要训练的种类个数，不包括背景</span></span><br><span class="line">pretrained_weights[<span class="string">'state_dict'</span>][<span class="string">'roi_head.bbox_head.fc_cls.weight'</span>].resize_(num_class+<span class="number">1</span>, <span class="number">1024</span>)</span><br><span class="line">pretrained_weights[<span class="string">'state_dict'</span>][<span class="string">'roi_head.bbox_head.fc_cls.bias'</span>].resize_(num_class+<span class="number">1</span>)</span><br><span class="line">pretrained_weights[<span class="string">'state_dict'</span>][<span class="string">'roi_head.bbox_head.fc_reg.weight'</span>].resize_(num_class*<span class="number">4</span>, <span class="number">1024</span>)</span><br><span class="line">pretrained_weights[<span class="string">'state_dict'</span>][<span class="string">'roi_head.bbox_head.fc_reg.bias'</span>].resize_(num_class*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">torch.save(pretrained_weights, <span class="string">"mask_rcnn_r50_fpn_1x_%d.pth"</span>%num_class)</span><br></pre></td></tr></table></figure><h3 id="2-2-修改schedule-1x-py"><a href="#2-2-修改schedule-1x-py" class="headerlink" title="2.2 修改schedule_1x.py"></a>2.2 修改schedule_1x.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># optimizer ：优化函数配置</span></span><br><span class="line"><span class="comment"># type：优化模型（函数）</span></span><br><span class="line"><span class="comment"># lr：学习率</span></span><br><span class="line"><span class="comment"># momentum：动量</span></span><br><span class="line">optimizer = dict(type=<span class="string">'SGD'</span>, lr=<span class="number">0.02</span>, momentum=<span class="number">0.9</span>, weight_decay=<span class="number">0.0001</span>)</span><br><span class="line"></span><br><span class="line">optimizer_config = dict(grad_clip=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># learning policy</span></span><br><span class="line">lr_config = dict(</span><br><span class="line">    policy=<span class="string">'step'</span>,</span><br><span class="line">    warmup=<span class="string">'linear'</span>,</span><br><span class="line">    warmup_iters=<span class="number">500</span>,</span><br><span class="line">    warmup_ratio=<span class="number">0.001</span>,</span><br><span class="line">    step=[<span class="number">8</span>, <span class="number">11</span>])</span><br><span class="line">total_epochs = <span class="number">50</span> <span class="comment"># 训练的总epoch数</span></span><br></pre></td></tr></table></figure><h3 id="2-3-修改default-runtime-py"><a href="#2-3-修改default-runtime-py" class="headerlink" title="2.3 修改default_runtime.py"></a>2.3 修改default_runtime.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">checkpoint_config = dict(interval=<span class="number">1</span>) <span class="comment"># 训练多少次保存一次权重</span></span><br><span class="line"><span class="comment"># yapf:disable</span></span><br><span class="line">log_config = dict(</span><br><span class="line">    interval=<span class="number">300</span>, <span class="comment"># 填写你的val2014文件加图片数目</span></span><br><span class="line">    hooks=[</span><br><span class="line">        dict(type=<span class="string">'TextLoggerHook'</span>),</span><br><span class="line">        <span class="comment"># dict(type='TensorboardLoggerHook')</span></span><br><span class="line">    ])</span><br><span class="line"><span class="comment"># yapf:enable</span></span><br><span class="line">dist_params = dict(backend=<span class="string">'nccl'</span>)</span><br><span class="line">log_level = <span class="string">'INFO'</span></span><br><span class="line">load_from = <span class="string">'mask_rcnn_r50_fpn_1x_1.pth'</span> <span class="comment"># 生成的新的权重文件</span></span><br><span class="line">resume_from = <span class="literal">None</span></span><br><span class="line">workflow = [(<span class="string">'train'</span>, <span class="number">1</span>)]</span><br></pre></td></tr></table></figure><h3 id="2-4-修改classes"><a href="#2-4-修改classes" class="headerlink" title="2.4 修改classes"></a>2.4 修改classes</h3><ul><li><p>修改coco.py 中的classes种类名称  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLASSES = (<span class="string">'xl'</span>)</span><br></pre></td></tr></table></figure></li><li><p>修改mask_rcnn_r50_fpn.py中的num_classes个数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_classes = <span class="number">1</span> <span class="comment">#不包括背景，一共有两处</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-5-训练"><a href="#2-5-训练" class="headerlink" title="2.5 训练"></a>2.5 训练</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/train.py configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py</span><br></pre></td></tr></table></figure><h3 id="2-6-测试"><a href="#2-6-测试" class="headerlink" title="2.6 测试"></a>2.6 测试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python demo/image_demo.py demo/<span class="number">00001.j</span>pg configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py work_dirs/mask_rcnn_r50_fpn_1x_coco/epoch_50.pth <span class="comment"># 测试单张图片</span></span><br><span class="line">python tools/test.py configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py work_dirs/mask_rcnn_r50_fpn_1x_coco/epoch_50.pth --eval segm <span class="comment"># 测试语义分割的 </span></span><br><span class="line"><span class="comment">#python tools/test.py configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py work_dirs/mask_rcnn_r50_fpn_1x_coco/epoch_50.pth --out ./result/mask_rcnn_r50_fpn_1x_coco_epoch50.pkl</span></span><br><span class="line"><span class="comment">#python tools/voc_eval.py ./result/mask_rcnn_r50_fpn_1x_coco_epoch50.pkl configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py</span></span><br><span class="line">python tools/analyze_logs.py plot_curve work_dirs/mask_rcnn_r50_fpn_1x_coco/<span class="number">20200605</span>_185330.log.json --keys bbox_mAP_50 --legend bbox_mAP_50</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>1.【扫盲】mmdetection 2.0全家桶训练（终结版）<a href="https://www.bilibili.com/video/BV1Ht4y1y74G" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Ht4y1y74G</a></p><p>2.<a href="https://github.com/open-mmlab/mmdetection" target="_blank" rel="noopener">https://github.com/open-mmlab/mmdetection</a></p><p>3.<a href="https://mmdetection.readthedocs.io/en/v2.0.0/index.html" target="_blank" rel="noopener">https://mmdetection.readthedocs.io/en/v2.0.0/index.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;mmdetection&quot;&gt;&lt;a href=&quot;#mmdetection&quot; class=&quot;headerlink&quot; title=&quot;mmdetection&quot;&gt;&lt;/a&gt;mmdetection&lt;/h1&gt;&lt;h2 id=&quot;1-mmdetection简介&quot;&gt;&lt;a href=&quot;#1-mmdetection简介&quot; class=&quot;headerlink&quot; title=&quot;1. mmdetection简介&quot;&gt;&lt;/a&gt;1. mmdetection简介&lt;/h2&gt;&lt;p&gt;mmdetection是基于pytorch的开源对象检测工具箱，由商汤科技和香港中文大学&lt;a href=&quot;http://mmlab.ie.cuhk.edu.hk/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Multimedia Laboratory, CUHK&lt;/a&gt;联合开发。&lt;/p&gt;
&lt;p&gt;主要特性：&lt;/p&gt;
    
    </summary>
    
    
      <category term="mmdetection" scheme="http://changsl231.xyz/categories/mmdetection/"/>
    
    
      <category term="pytorch" scheme="http://changsl231.xyz/tags/pytorch/"/>
    
      <category term="深度学习" scheme="http://changsl231.xyz/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>Markdown学习笔记</title>
    <link href="http://changsl231.xyz/2020/06/08/Markdown%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://changsl231.xyz/2020/06/08/Markdown%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2020-06-08T15:11:10.000Z</published>
    <updated>2020-06-09T14:02:33.195Z</updated>
    
    <content type="html"><![CDATA[<p>这是一个Markdown的学习博客</p><a id="more"></a><h1 id="1-Markdown"><a href="#1-Markdown" class="headerlink" title="1. Markdown"></a>1. Markdown</h1><h2 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h2><p>阴影，高亮：<code>你好</code><br>字体颜色：<font color = 'red'></p><p>你好呀</p><p>你好呀</p><p>你好呀</p></font><p>你好呀</p><h2 id="1-2-标题"><a href="#1-2-标题" class="headerlink" title="1.2 标题"></a>1.2 标题</h2><h2 id="1-3-段落"><a href="#1-3-段落" class="headerlink" title="1.3 段落"></a>1.3 段落</h2><h2 id="1-4-图片"><a href="#1-4-图片" class="headerlink" title="1.4 图片"></a>1.4 图片</h2><center><p><img src="../Markdown%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt="RUNOOB 图标"></p><p><img src="../Markdown%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt="RUNOOB 图标" title="RUNOOB"></p><img src="../Markdown学习笔记/1.png" width="50%"><center><b>图一.菜鸟教程</b></center><p>菜鸟教程</p><h2 id="1-5-链接"><a href="#1-5-链接" class="headerlink" title="1.5 链接"></a>1.5 链接</h2><p>这是一个链接 <a href="https://www.runoob.com" target="_blank" rel="noopener">菜鸟教程</a></p><p><a href="https://www.runoob.com" target="_blank" rel="noopener">https://www.runoob.com</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这是一个Markdown的学习博客&lt;/p&gt;
    
    </summary>
    
    
      <category term="Markdown" scheme="http://changsl231.xyz/categories/Markdown/"/>
    
    
      <category term="Markdown" scheme="http://changsl231.xyz/tags/Markdown/"/>
    
      <category term="blog" scheme="http://changsl231.xyz/tags/blog/"/>
    
      <category term="html" scheme="http://changsl231.xyz/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://changsl231.xyz/2020/06/07/hello-world/"/>
    <id>http://changsl231.xyz/2020/06/07/hello-world/</id>
    <published>2020-06-07T12:24:19.537Z</published>
    <updated>2020-06-08T10:17:29.860Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Start&quot;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h3 id=&quot;Create-a-new-post&quot;&gt;&lt;a href=&quot;#Create-a-new-post&quot; class=&quot;headerlink&quot; title=&quot;Create a new post&quot;&gt;&lt;/a&gt;Create a new post&lt;/h3&gt;
    
    </summary>
    
    
      <category term="Hexo" scheme="http://changsl231.xyz/categories/Hexo/"/>
    
    
      <category term="博客" scheme="http://changsl231.xyz/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
</feed>
